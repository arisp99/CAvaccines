<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vaccines and Infectious Disease â€¢ CAvaccines</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Vaccines and Infectious Disease">
<meta property="og:description" content="CAvaccines">
<meta property="og:image" content="https://arisp99.github.io/CAvaccines/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CAvaccines</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vaccine_disease.html">Vaccines and Infectious Disease</a>
    </li>
    <li>
      <a href="../articles/WHO_data.html">WHO Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/arisp99/Cavaccines/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vaccine_disease_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Vaccines and Infectious Disease</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/arisp99/Cavaccines/blob/master/vignettes/vaccine_disease.Rmd"><code>vignettes/vaccine_disease.Rmd</code></a></small>
      <div class="hidden name"><code>vaccine_disease.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">CAvaccines</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)</pre></body></html></div>
<p>The first step in any analysis we want to perform is to first read in our datasets. For this analysis, we will utilize two datasets, both found in the Data/ folder of this project: county_vaccination, and pertussis. Both these datasets are documented in the associated help files, but we summarize here for convenience. Before continuing with this vignette, we strongly encourage readers to examine the documentation for each dataset, if they have not already.</p>
<ul>
<li>
<code>county_vaccination</code> is a dataset containing information about vaccination rates for each CA county for the years of 2008-2017.</li>
<li>
<code>pertussis</code> is a dataset containing all pertussis cases, arranged by county, from the years of 2008-2017 in the state of California.</li>
</ul>
<p>We first print out the variable names so that readers are aware of the variables in each dataset.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># We print the names of each dataset</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">county_vaccination</span>)
<span class="co">#&gt;  [1] "Jurisdiction"        "total_Enrollment"    "total_Up_to_Date"   </span>
<span class="co">#&gt;  [4] "total_Conditional"   "total_PME"           "total_PBE"          </span>
<span class="co">#&gt;  [7] "total_DTP"           "total_Polio"         "total_MMR"          </span>
<span class="co">#&gt; [10] "total_HepB"          "total_Var"           "percent_Up_to_Date" </span>
<span class="co">#&gt; [13] "percent_Conditional" "percent_PME"         "percent_PBE"        </span>
<span class="co">#&gt; [16] "percent_DTP"         "percent_Polio"       "percent_MMR"        </span>
<span class="co">#&gt; [19] "percent_HepB"        "percent_Var"         "Year"</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">pertussis</span>)
<span class="co">#&gt; [1] "Jurisdiction" "Year"         "Cases"        "Rates"</span></pre></body></html></div>
<div id="data-visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#data-visualization" class="anchor"></a>Data Visualization</h2>
<p>One particularly useful way to understand our data is to visualize it. To do this, we will create various plots of our variables.</p>
<div id="incidence" class="section level3">
<h3 class="hasAnchor">
<a href="#incidence" class="anchor"></a>Incidence</h3>
<p>We first start with our <code>pertussis</code> dataset. One way to visualize our data is to create boxplots of the cases and rates every year.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Remove missing data</span>
<span class="no">pertussis_omit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="no">pertussis</span>)

<span class="co"># Cases</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">pertussis_omit</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Year</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">Cases</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">Year</span>))) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span>(<span class="kw">outlier.shape</span> <span class="kw">=</span> <span class="fl">NA</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"gray40"</span>) +
  <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>,
        <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">15</span>),
        <span class="kw">axis.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">10</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Boxplot of Cases By Year"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Year"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Cases"</span>)</pre></body></html></div>
<p><img src="vaccine_disease_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><html><body><pre class="r">
<span class="co"># Rates</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">pertussis_omit</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Year</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">Rates</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">Year</span>))) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span>(<span class="kw">outlier.shape</span> <span class="kw">=</span> <span class="fl">NA</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.4</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"gray40"</span>) +
  <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>,
        <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">15</span>),
        <span class="kw">axis.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">10</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Boxplot of Rates By Year"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Year"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Rates"</span>)</pre></body></html></div>
<p><img src="vaccine_disease_files/figure-html/unnamed-chunk-3-2.png" width="672"></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r">
# Code below is a method to remove outliers if deemed needed
# ylim_cases = grDevices::boxplot.stats(pertussis_omit$Rates)$stats[c(1, 5)]
# ylim_cases = quantile(pertussis_omit$Rates, c(0, 1))
# include_cases + coord_cartesian(ylim = ylim_cases)</pre></body></html></div>
<p>As is clear by the above graphs, in some counties the rate and cases are very high and thus the data is hard to interpret. In order to combat this, instead of plotting the cases and rates for every county, we could simply find the average number each year. This approach is shown below,</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># Create dataframe</span>
<span class="no">pertussis_means</span> <span class="kw">&lt;-</span> <span class="no">pertussis_omit</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">Year</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(
    <span class="kw">avg_cases</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">Cases</span>),
    <span class="kw">avg_rates</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">Rates</span>), <span class="kw">.groups</span> <span class="kw">=</span> <span class="st">"drop_last"</span>)

<span class="co"># Plot average for cases and rates</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">pertussis_means</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Year</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">avg_cases</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">avg_cases</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span>() + <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>,
        <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">15</span>),
        <span class="kw">axis.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">10</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Histogram of Average Cases By Year"</span>,
       <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Year"</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Average Cases"</span>)</pre></body></html></div>
<p><img src="vaccine_disease_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r">
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">pertussis_means</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Year</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">avg_rates</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">avg_rates</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span>() + <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>,
        <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">15</span>),
        <span class="kw">axis.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">10</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Histogram of Average Rates By Year"</span>,
       <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Year"</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Average Rates"</span>)</pre></body></html></div>
<p><img src="vaccine_disease_files/figure-html/unnamed-chunk-4-2.png" width="672"></p>
<p>To further understand what our data looks like for any particular year, we will construct a map of the rates of infection for a typical year: 2013. Since the data from 2013 spans a large range, we will transform the shading of the map by log base 2. This will make it easier to interpret. Note that when we transform the data, we do not actually change the values of our data. The data remains the same, but we change the way data points are colored.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># Select year 2013</span>
<span class="no">pertussiss_to_map</span> <span class="kw">&lt;-</span> <span class="no">pertussis</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">Year</span> <span class="kw">==</span> <span class="st">"2013"</span>)

<span class="co"># Map with all data from 2013</span>
<span class="fu"><a href="../reference/map_plot.html">map_plot</a></span>(<span class="no">pertussiss_to_map</span>,
         <span class="st">"Rates"</span>,
         <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">16</span>, <span class="fl">32</span>, <span class="fl">64</span>, <span class="fl">128</span>),
         <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Rates Per 100,000 Individuals In 2013"</span>,
         <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"Rates"</span>,
         <span class="kw">trans</span> <span class="kw">=</span> <span class="kw pkg">scales</span><span class="kw ns">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/log_trans.html">pseudo_log_trans</a></span>(<span class="kw">base</span> <span class="kw">=</span> <span class="fl">2</span>))</pre></body></html></div>
<p><img src="vaccine_disease_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>We below present a way to create a gif from the data for all years. This is a superior approach to only plotting one year as was done in the previous code chunk. Note that in order to run the below code chunk, some packages may first need to be installed.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># Create dataset</span>
<span class="no">pertussiss_animated</span> <span class="kw">&lt;-</span> <span class="no">pertussis</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>()
<span class="no">pertussiss_animated</span>$<span class="no">Year</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">pertussiss_animated</span>$<span class="no">Year</span>))

<span class="co"># Animate data</span>
<span class="no">animated</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/map_plot.html">map_plot</a></span>(<span class="no">pertussiss_animated</span>,
                    <span class="st">"Rates"</span>,
                    <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">16</span>, <span class="fl">32</span>, <span class="fl">64</span>, <span class="fl">128</span>),
                    <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Rates Per 100,000 Individuals"</span>,
                    <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"Rates"</span>,
                    <span class="kw">trans</span> <span class="kw">=</span> <span class="kw pkg">scales</span><span class="kw ns">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/log_trans.html">pseudo_log_trans</a></span>(<span class="kw">base</span> <span class="kw">=</span> <span class="fl">2</span>)) +
  <span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="no">Year</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Rates Per 100,000 Individuals in {frame_time}"</span>)

<span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(<span class="no">animated</span>, <span class="kw">fps</span> <span class="kw">=</span> <span class="no">fps</span>)
<span class="co">#&gt; Warning: No renderer available. Please install the gifski, av, or magick package</span>
<span class="co">#&gt; to create animated output</span></pre></body></html></div>
</div>
<div id="vaccination-rates" class="section level3">
<h3 class="hasAnchor">
<a href="#vaccination-rates" class="anchor"></a>Vaccination Rates</h3>
<p>We now move on to our <code>county_vaccination</code> dataset. We first start by creating maps of CA counties and shading the counties according to a specific measurement. The following set of graphs shows the percent of students with DTP vaccinations, the percent of students that are up to date on their vaccinations, the percent of students that have a PME, and the percent of students that have a PBE.</p>
<p>One option for visualizing these variables is to look at a specific year. Below, we look at the year 2013.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># Graphs are for the year 2013</span>
<span class="no">vac_to_map</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">county_vaccination</span>, <span class="no">Year</span> <span class="kw">==</span> <span class="st">"2013"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">Jurisdiction</span>, <span class="no">percent_DTP</span>, <span class="no">percent_Up_to_Date</span>,
                <span class="no">percent_PME</span>, <span class="no">percent_PBE</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span>(<span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"percent_"</span>)), ~<span class="no">.</span>*<span class="fl">100</span>)

<span class="fu"><a href="../reference/map_plot.html">map_plot</a></span>(<span class="no">vac_to_map</span>, <span class="st">"percent_Up_to_Date"</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Up to Date"</span>)</pre></body></html></div>
<p><img src="vaccine_disease_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/map_plot.html">map_plot</a></span>(<span class="no">vac_to_map</span>, <span class="st">"percent_PME"</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"PME"</span>)</pre></body></html></div>
<p><img src="vaccine_disease_files/figure-html/unnamed-chunk-7-2.png" width="672"></p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="../reference/map_plot.html">map_plot</a></span>(<span class="no">vac_to_map</span>, <span class="st">"percent_PBE"</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"PBE"</span>)</pre></body></html></div>
<p><img src="vaccine_disease_files/figure-html/unnamed-chunk-7-3.png" width="672"></p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/map_plot.html">map_plot</a></span>(<span class="no">vac_to_map</span>, <span class="st">"percent_DTP"</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"DTP Vaccinations"</span>)</pre></body></html></div>
<p><img src="vaccine_disease_files/figure-html/unnamed-chunk-7-4.png" width="672"></p>
<p>As we did with our <code>pertussis</code> dataset, however, we can also animate maps of CA.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co"># Create dataset</span>
<span class="no">vac_animated</span> <span class="kw">&lt;-</span> <span class="no">county_vaccination</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">Jurisdiction</span>, <span class="no">Year</span>,
                <span class="no">percent_DTP</span>, <span class="no">percent_Up_to_Date</span>, <span class="no">percent_PME</span>, <span class="no">percent_PBE</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span>(<span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"percent_"</span>)), ~<span class="no">.</span>*<span class="fl">100</span>)
<span class="no">vac_animated</span>$<span class="no">Year</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">vac_animated</span>$<span class="no">Year</span>))

<span class="co"># Animate up to data data</span>
<span class="no">animated</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/map_plot.html">map_plot</a></span>(<span class="no">vac_animated</span>,
                    <span class="st">"percent_Up_to_Date"</span>) +
  <span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="no">Year</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Up to Date in {frame_time}"</span>)

<span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(<span class="no">animated</span>, <span class="kw">fps</span> <span class="kw">=</span> <span class="no">fps</span>)
<span class="co">#&gt; Warning: No renderer available. Please install the gifski, av, or magick package</span>
<span class="co">#&gt; to create animated output</span></pre></body></html></div>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co"># Animate PME data</span>
<span class="no">animated</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/map_plot.html">map_plot</a></span>(<span class="no">vac_animated</span>,
                    <span class="st">"percent_PME"</span>) +
  <span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="no">Year</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"PME in {frame_time}"</span>)

<span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(<span class="no">animated</span>, <span class="kw">fps</span> <span class="kw">=</span> <span class="no">fps</span>)
<span class="co">#&gt; Warning: No renderer available. Please install the gifski, av, or magick package</span>
<span class="co">#&gt; to create animated output</span></pre></body></html></div>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co"># Animate PBE data</span>
<span class="no">animated</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/map_plot.html">map_plot</a></span>(<span class="no">vac_animated</span>,
                    <span class="st">"percent_PBE"</span>) +
  <span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="no">Year</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"PBE in {frame_time}"</span>)

<span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(<span class="no">animated</span>, <span class="kw">fps</span> <span class="kw">=</span> <span class="no">fps</span>)
<span class="co">#&gt; Warning: No renderer available. Please install the gifski, av, or magick package</span>
<span class="co">#&gt; to create animated output</span></pre></body></html></div>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="co"># Animate DTP data</span>
<span class="no">animated</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/map_plot.html">map_plot</a></span>(<span class="no">vac_animated</span>,
                    <span class="st">"percent_DTP"</span>) +
  <span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="no">Year</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"DTP in {frame_time}"</span>)

<span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(<span class="no">animated</span>, <span class="kw">fps</span> <span class="kw">=</span> <span class="no">fps</span>)
<span class="co">#&gt; Warning: No renderer available. Please install the gifski, av, or magick package</span>
<span class="co">#&gt; to create animated output</span></pre></body></html></div>
</div>
</div>
<div id="modeling" class="section level2">
<h2 class="hasAnchor">
<a href="#modeling" class="anchor"></a>Modeling</h2>
<p>The next stage in our analysis is to model the data. More specifically, we seek to evaluate the relationship between vaccination rates and disease incidence. In order to model our data, however, we must first set up the data. In the following code chunk, we combine our two datasets.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="co"># Define a not in operator</span>
<span class="no">`%notin%`</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span>(<span class="no">`%in%`</span>)

<span class="co"># Combine the data sets and remove the total county</span>
<span class="no">model_data</span>  <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span>(<span class="no">county_vaccination</span>, <span class="no">pertussis</span>,
                                <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Jurisdiction"</span>, <span class="st">"Year"</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">Jurisdiction</span> <span class="kw">!=</span> <span class="st">"totals"</span>)</pre></body></html></div>
<p>Recall that in our data there are both rates of disease and cases of disease. Likewise, there is vaccination data that represents totals, and other vaccination data that represents percents. In modeling our data, we can look at combinations of these different types of data. We can either look at the total number for vaccination rates and the total number of cases or we can look at the percent of vaccination rates and the rates of disease.</p>
<p>We first look at the number of total cases and the total vaccination rates.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="co"># Isolate variables, scale the independent variables, and remove missing data</span>
<span class="no">scaled_total_data</span> <span class="kw">&lt;-</span> <span class="no">model_data</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="fu">one_of</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Jurisdiction"</span>, <span class="st">"Year"</span>, <span class="st">"Rates"</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="fu">contains</span>(<span class="st">"percent_"</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span>(<span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(-<span class="no">Cases</span>), <span class="no">scale</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>() <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>()

<span class="co"># Run a linear regression several times and take the average R2</span>
<span class="no">results_cases</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">1000</span>){
  <span class="no">t_sample</span> <span class="kw">=</span> <span class="kw pkg">caTools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/caTools/man/sample.split.html">sample.split</a></span>(<span class="no">scaled_total_data</span>$<span class="no">Cases</span>, <span class="kw">SplitRatio</span> <span class="kw">=</span> <span class="fl">0.7</span>)
  <span class="no">t_train</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">scaled_total_data</span>, <span class="no">t_sample</span> <span class="kw">==</span> <span class="fl">TRUE</span>)
  <span class="no">t_test</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">scaled_total_data</span>, <span class="no">t_sample</span> <span class="kw">==</span> <span class="fl">FALSE</span>)

  <span class="no">lm</span> <span class="kw">&lt;-</span> <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">Cases</span> ~<span class="no">.</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">t_train</span>)
  <span class="co"># print(summary(lm))</span>

  <span class="no">predict_lm</span> <span class="kw">&lt;-</span> <span class="no">lm</span> <span class="kw">%&gt;%</span> <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">t_test</span>)
  <span class="no">results_cases</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">results_cases</span>,
                     <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw pkg">caret</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">R2</a></span>(<span class="no">predict_lm</span>, <span class="no">t_test</span>$<span class="no">Cases</span>), <span class="fl">4</span>))
}
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Average Test R2 Linear:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">results_cases</span>))))
<span class="co">#&gt; [1] "Average Test R2 Linear: 0.4202957"</span></pre></body></html></div>
<p>We next look at the rates of cases and the percent of vaccination rates.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="co"># Isolate variables and remove missing data</span>
<span class="no">scaled_percent_data</span> <span class="kw">&lt;-</span> <span class="no">model_data</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="fu">one_of</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Jurisdiction"</span>, <span class="st">"Year"</span>, <span class="st">"Cases"</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="fu">contains</span>(<span class="st">"total_"</span>)) <span class="kw">%&gt;%</span>
  <span class="co"># dplyr::mutate_if(is.numeric, scale) %&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>() <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>()

<span class="co"># scaled_percent_data$Rates &lt;- scaled_percent_data$Rates/1000</span>

<span class="co"># Run a linear regression several times and take the average R2</span>
<span class="no">results_percent</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">1000</span>){
  <span class="no">p_sample</span> <span class="kw">=</span> <span class="kw pkg">caTools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/caTools/man/sample.split.html">sample.split</a></span>(<span class="no">scaled_percent_data</span>$<span class="no">Rates</span>, <span class="kw">SplitRatio</span> <span class="kw">=</span> <span class="fl">0.7</span>)
  <span class="no">p_train</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">scaled_percent_data</span>, <span class="no">p_sample</span> <span class="kw">==</span> <span class="fl">TRUE</span>)
  <span class="no">p_test</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">scaled_percent_data</span>, <span class="no">p_sample</span> <span class="kw">==</span> <span class="fl">FALSE</span>)

  <span class="no">lm</span> <span class="kw">&lt;-</span> <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">Rates</span> ~<span class="no">.</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">p_train</span>)
  <span class="co"># summary(lm)</span>

  <span class="no">predict_lm</span> <span class="kw">&lt;-</span> <span class="no">lm</span> <span class="kw">%&gt;%</span> <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">p_test</span>)
  <span class="no">results_percent</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">results_percent</span>,
                       <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw pkg">caret</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">R2</a></span>(<span class="no">predict_lm</span>, <span class="no">p_test</span>$<span class="no">Rates</span>), <span class="fl">4</span>))
}
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Average Test R2 Linear:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">results_percent</span>))))
<span class="co">#&gt; [1] "Average Test R2 Linear: 0.0190044"</span></pre></body></html></div>
<div id="correlation" class="section level3">
<h3 class="hasAnchor">
<a href="#correlation" class="anchor"></a>Correlation</h3>
<p>After running the above models, it can be seen that the R2 value is not particularly high. There may be many reasons for this, but one might be that the data is highly correlated. Below, we therefore plot a correlation plot of the independent variables.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="co"># Set up data</span>
<span class="no">corr_data</span> <span class="kw">&lt;-</span> <span class="no">model_data</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="st">"Jurisdiction"</span>)

<span class="co"># Create correlation matrix</span>
<span class="no">corr_mat</span> <span class="kw">&lt;-</span> <span class="kw pkg">Hmisc</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/rcorr.html">rcorr</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">scaled_total_data</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">"spearman"</span>)
<span class="no">M</span> <span class="kw">&lt;-</span> <span class="no">corr_mat</span>$<span class="no">r</span>
<span class="no">P_mat</span> <span class="kw">&lt;-</span> <span class="no">corr_mat</span>$<span class="no">P</span>

<span class="co"># Plot the correlation values</span>
<span class="kw pkg">corrplot</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span>(<span class="no">M</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"color"</span>,
                   <span class="kw">col</span> <span class="kw">=</span> <span class="kw pkg">RColorBrewer</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="kw">n</span><span class="kw">=</span><span class="fl">8</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"PuBu"</span>),
  <span class="kw">addCoef.col</span> <span class="kw">=</span> <span class="st">"black"</span>,
  <span class="kw">tl.col</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">tl.srt</span> <span class="kw">=</span> <span class="fl">50</span>,<span class="kw">tl.cex</span> <span class="kw">=</span> <span class="fl">0.60</span>,
  <span class="kw">p.mat</span> <span class="kw">=</span> <span class="no">P_mat</span>, <span class="kw">sig.level</span> <span class="kw">=</span> <span class="fl">0.05</span>, <span class="kw">pch.cex</span> <span class="kw">=</span> <span class="fl">5</span>,
  <span class="kw">mar</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0</span>), <span class="kw">number.cex</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="vaccine_disease_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Aris Paschalidis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
