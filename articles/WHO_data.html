<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WHO Data â€¢ CAvaccines</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="WHO Data">
<meta property="og:description" content="CAvaccines">
<meta property="og:image" content="https://arisp99.github.io/CAvaccines/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CAvaccines</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vaccine_disease.html">Vaccines and Infectious Disease</a>
    </li>
    <li>
      <a href="../articles/WHO_data.html">WHO Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/arisp99/Cavaccines/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="WHO_data_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>WHO Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/arisp99/Cavaccines/blob/master/vignettes/WHO_data.Rmd"><code>vignettes/WHO_data.Rmd</code></a></small>
      <div class="hidden name"><code>WHO_data.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://arisp99.github.io/CAvaccines/">CAvaccines</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></code></pre></div>
<p>This article serves to examine the relationship between worldwide pertussis cases and worldwide DTP cases. The dataset we will utilize comes from the World Health Organization (WHO) and can be found online.</p>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>In order to extract all the data we need, we will need to utilize multiple files found in the extdata folder of this package. The first dataset, <code>population_country</code>, contains the number of individuals in each country around the globe.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Population Numbers</span>
<span class="va">population_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>
  <span class="st">"extdata"</span>,
  <span class="st">"population-by-country.xlsx"</span>,
  package <span class="op">=</span> <span class="st">"CAvaccines"</span>
<span class="op">)</span>

<span class="va">population_country</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span>
  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">population_file</span>,
                     na <span class="op">=</span> <span class="st">""</span>,
                     range <span class="op">=</span> <span class="st">"B2:D191"</span>,
                     col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">population_country</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ISO_code"</span>, <span class="st">"Year"</span>, <span class="st">"Population"</span><span class="op">)</span>
<span class="va">population_country</span><span class="op">$</span><span class="va">Year</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></code></pre></div>
<p>The second dataset, <code>incidence_series</code>, contains the number of pertussis cases each year from 1980 till 2018 across the world.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Incidence</span>
<span class="va">incidence_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>
  <span class="st">"extdata"</span>,
  <span class="st">"incidence_series.xls"</span>,
  package <span class="op">=</span> <span class="st">"CAvaccines"</span>
<span class="op">)</span>

<span class="va">incidence_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span>
  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">incidence_file</span>,
                     sheet <span class="op">=</span> <span class="st">"Pertussis"</span>,
                     na <span class="op">=</span> <span class="st">""</span>,
                     col_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="va">incidence_series</span> <span class="op">&lt;-</span> <span class="va">incidence_series</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Cases</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">WHO_REGION</span>, <span class="va">ISO_code</span>, <span class="va">Cname</span>, <span class="va">Disease</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Adjust several country names. In particular, several country names have the</span>
<span class="co"># characters "(the)" appended to the end of the name. We remove such characters</span>
<span class="co"># from the end of the country name. In addition, we change the names of USA and</span>
<span class="co"># Russia.</span>
<span class="va">incidence_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">incidence_series</span><span class="op">$</span><span class="va">Cname</span>, <span class="st">" \\(.*\\)"</span><span class="op">)</span>
<span class="va">incidence_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">incidence_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"United States of America"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"USA"</span>
<span class="va">incidence_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">incidence_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"Russian Federation"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Russia"</span>

<span class="co"># Combine incidence data with population count data</span>
<span class="va">incidence_series</span> <span class="op">&lt;-</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">incidence_series</span>, <span class="va">population_country</span>, by <span class="op">=</span> <span class="st">"ISO_code"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Cases <span class="op">=</span> <span class="va">Cases</span> <span class="op">/</span> <span class="va">Population</span><span class="op">)</span></code></pre></div>
<p>Lastly, the third dataset we will combine, <code>coverage_series</code>, contains information regarding vaccination coverage rates across the globe for the years 1966-2018.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Coverage</span>
<span class="va">coverage_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>
  <span class="st">"extdata"</span>,
  <span class="st">"Numeric_coverage_series.xls"</span>,
  package <span class="op">=</span> <span class="st">"CAvaccines"</span>
<span class="op">)</span>

<span class="va">coverage_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span>
  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">coverage_file</span>,
                     sheet <span class="op">=</span> <span class="st">"world_coverage"</span>,
                     na <span class="op">=</span> <span class="st">""</span>,
                     range <span class="op">=</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/cell-specification.html">cell_cols</a></span><span class="op">(</span><span class="st">"A:G"</span><span class="op">)</span>,
                     col_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Convert the expand column into multiple columns with each vaccine that was</span>
<span class="co"># administered and convert percent coverage into a decimal.</span>
<span class="va">coverage_series</span> <span class="op">&lt;-</span> <span class="va">coverage_series</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Percent_coverage <span class="op">=</span> <span class="va">Percent_covrage</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Percent_coverage <span class="op">=</span> <span class="va">Percent_coverage</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op">(</span><span class="va">Vaccine</span>, <span class="va">Percent_coverage</span><span class="op">)</span>

<span class="co"># Convert the year to a character and remove all variables that have more than</span>
<span class="co"># 40% missing data</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span>
<span class="va">coverage_series</span> <span class="op">&lt;-</span> <span class="va">coverage_series</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">coverage_series</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.40</span><span class="op">)</span><span class="op">]</span>

<span class="co"># Fixing country names</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span>, <span class="st">" \\(.*\\)"</span><span class="op">)</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"Brunei Darussalam"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Brunei"</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"Cabo Verde"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Cape Verde"</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"Congo"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Republic of Congo"</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"CÃ´te d'Ivoire"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Ivory Coast"</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"Democratic People's Republic of Korea"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"North Korea"</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"Lao People's Democratic Republic"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Laos"</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"North Macedonia"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Macedonia"</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"Republic of Moldova"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Moldova"</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"Syrian Arab Republic"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Syria"</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"United Republic of Tanzania"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Tanzania"</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"Viet Nam"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Vietnam"</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"United States of America"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"USA"</span>
<span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span><span class="op">[</span><span class="va">coverage_series</span><span class="op">$</span><span class="va">Cname</span> <span class="op">==</span> <span class="st">"Russian Federation"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Russia"</span></code></pre></div>
</div>
<div id="visualize" class="section level2">
<h2 class="hasAnchor">
<a href="#visualize" class="anchor"></a>Visualize</h2>
<p>Now that we have read in all our data and properly formatted it, the next step is to visualize our data. In order to achieve this, we will find the average vaccination rates in each country and then plot those on a world map.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Finding average vaccination rates in each country</span>
<span class="va">to_map</span> <span class="op">&lt;-</span> <span class="va">coverage_series</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Cname</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>BCG     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">BCG</span><span class="op">*</span><span class="fl">100</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
                   DTP1    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">DTP1</span><span class="op">*</span><span class="fl">100</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
                   DTP3    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">DTP3</span><span class="op">*</span><span class="fl">100</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
                   HepB3   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">HepB3</span><span class="op">*</span><span class="fl">100</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
                   MCV1    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">MCV1</span><span class="op">*</span><span class="fl">100</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
                   TT2plus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">TT2plus</span><span class="op">*</span><span class="fl">100</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
                   .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>

<span class="co"># Determine min and max values. This will allows us to make a nicer looking plot</span>
<span class="co"># with more informative shading</span>
<span class="va">min_v</span> <span class="op">=</span> <span class="fu">DescTools</span><span class="fu">::</span><span class="fu"><a href="https://andrisignorell.github.io/DescTools/reference/RoundTo.html">RoundTo</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">to_map</span><span class="op">$</span><span class="va">DTP3</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">max_v</span> <span class="op">=</span> <span class="fu">DescTools</span><span class="fu">::</span><span class="fu"><a href="https://andrisignorell.github.io/DescTools/reference/RoundTo.html">RoundTo</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">to_map</span><span class="op">$</span><span class="va">DTP3</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">diff</span> <span class="op">=</span> <span class="va">max_v</span> <span class="op">-</span> <span class="va">min_v</span>

<span class="co"># Based on min and max values, determine optimal breaks. We stipulate</span>
<span class="co"># that there should be at least five breaks</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">diff</span> <span class="op">&lt;=</span> <span class="fl">5</span><span class="op">)</span><span class="op">{</span>
  <span class="va">breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">min_v</span>, <span class="va">max_v</span>, <span class="fl">1</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">diff</span> <span class="op">&lt;=</span> <span class="fl">25</span><span class="op">)</span><span class="op">{</span>
  <span class="va">breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">min_v</span>, <span class="va">max_v</span>, <span class="fl">5</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="va">breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">min_v</span>, <span class="va">max_v</span>, <span class="fl">10</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">countries</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span>
<span class="co"># setdiff(to_map$Cname, countries$region)</span>
<span class="co"># setdiff(countries$region, to_map$Cname)</span>
  
<span class="co"># Combine mapping data and our data</span>
<span class="va">world_map</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">countries</span>, <span class="va">to_map</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"region"</span> <span class="op">=</span> <span class="st">"Cname"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Create map</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">world_map</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">long</span>, y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">lat</span>, group <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">group</span>, fill <span class="op">=</span> <span class="va">DTP3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html">coord_quickmap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"viridis"</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">min_v</span>, <span class="va">max_v</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,
      legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Plot of DTP Rates in the World"</span>, fill <span class="op">=</span> <span class="st">"Rates (%)"</span><span class="op">)</span></code></pre></div>
<p><img src="WHO_data_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div id="modeling" class="section level2">
<h2 class="hasAnchor">
<a href="#modeling" class="anchor"></a>Modeling</h2>
<p>The final step is to combine everything together and try to predict the number of cases based on the vaccination rates worldwide. As an example, we will focus on the year 2015.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Combine data</span>
<span class="va">incidence_series_2015</span> <span class="op">&lt;-</span> <span class="va">incidence_series</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="st">"2015"</span><span class="op">)</span>
<span class="va">coverage_series_2015</span> <span class="op">&lt;-</span> <span class="va">coverage_series</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="st">"2015"</span><span class="op">)</span>
<span class="va">coverage_series_2015</span><span class="op">$</span><span class="va">TT2plus</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="va">combined_2015</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">incidence_series_2015</span>, <span class="va">coverage_series_2015</span>, 
                                  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WHO_REGION"</span>, <span class="st">"ISO_code"</span>, 
                                         <span class="st">"Cname"</span>, <span class="st">"Year"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Cases</span>, <span class="va">BCG</span>, <span class="va">DTP1</span>, <span class="va">DTP3</span>, <span class="va">HepB3</span>, <span class="va">MCV1</span>, <span class="va">Pol3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Run a linear regression and compute the test R2 value</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>
<span class="va">t_sample</span> <span class="op">=</span> <span class="fu">caTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caTools/man/sample.split.html">sample.split</a></span><span class="op">(</span><span class="va">combined_2015</span><span class="op">$</span><span class="va">Cases</span>, SplitRatio <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="va">t_train</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">combined_2015</span>, <span class="va">t_sample</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">t_test</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">combined_2015</span>, <span class="va">t_sample</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">lm</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Cases</span> <span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">t_train</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lm</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; stats::lm(formula = Cases ~ ., data = t_train)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -0.4592 -0.3527 -0.2263 -0.0620  4.8742 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)</span>
<span class="co">#&gt; (Intercept) -0.08086    0.09711  -0.833    0.408</span>
<span class="co">#&gt; BCG          0.04164    0.15337   0.272    0.787</span>
<span class="co">#&gt; DTP1        -0.04643    0.25908  -0.179    0.858</span>
<span class="co">#&gt; DTP3         0.95612    1.45467   0.657    0.513</span>
<span class="co">#&gt; HepB3       -0.81563    1.36304  -0.598    0.552</span>
<span class="co">#&gt; MCV1        -0.22438    0.28365  -0.791    0.432</span>
<span class="co">#&gt; Pol3         0.15761    0.44761   0.352    0.726</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 0.7964 on 63 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.02868,    Adjusted R-squared:  -0.06383 </span>
<span class="co">#&gt; F-statistic:  0.31 on 6 and 63 DF,  p-value: 0.9295</span>

<span class="va">predict_lm</span> <span class="op">&lt;-</span> <span class="va">lm</span> <span class="op">%&gt;%</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">t_test</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Test R2 Linear:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">R2</a></span><span class="op">(</span><span class="va">predict_lm</span>, <span class="va">t_test</span><span class="op">$</span><span class="va">Cases</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "Test R2 Linear: 0.0528"</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Aris Paschalidis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
